     //console.log("DEntro")
//Initialize Firebase
var config = {
    apiKey: "AIzaSyAWe_eDwVTwISgCcCDy5PPxW4bZlq6sHCQ",
    authDomain: "tfg-findegrado.firebaseapp.com",
    databaseURL: "https://tfg-findegrado.firebaseio.com",
    projectId: "tfg-findegrado",
    storageBucket: "tfg-findegrado.appspot.com",
    messagingSenderId: "281469807949"
};

firebase.initializeApp(config);
// Initialize Cloud Firestore through Firebase
const firestore = firebase.firestore();
const settings = { timestampsInSnapshots: true };
firestore.settings(settings);
// Catch buttons


     <script>
        // Initialize Firebase
        var config = {
            apiKey: "AIzaSyAWe_eDwVTwISgCcCDy5PPxW4bZlq6sHCQ",
            authDomain: "tfg-findegrado.firebaseapp.com",
            databaseURL: "https://tfg-findegrado.firebaseio.com",
            projectId: "tfg-findegrado",
            storageBucket: "tfg-findegrado.appspot.com",
            messagingSenderId: "281469807949"
        };
        firebase.initializeApp(config);
    </script>
    <!-- Custom styles for this template -->

  <script>

  const btnClose = document.getElementById("btnClose");
btnClose.addEventListener('click', () => {
    deleteAllCookies();
    //console.log("uffffff");
    firebase.auth().signOut().then(function() {
        // Sign-out successful.
        console.log("Sign-out successful")

    }).catch(function(error) {
        console.log(" An error happened. Sign-out incorrect")
        // An error happened.
    });
});

function deleteAllCookies() {
    var cookies = document.cookie.split(";");
    for (var i = 0; i < cookies.length; i++) {
        var cookie = cookies[i];
        var eqPos = cookie.indexOf("=");
        var name = eqPos > -1 ? cookie.substr(0, eqPos) : cookie;
        document.cookie = name + "=;expires=Thu, 01 Jan 1970 00:00:00 GMT";
    function subirImagen(){
      var fichero = document.getElementById("imagen");
      console.log(fichero.files[0])
      var imagenSubir = fichero.files[0];
      console.log(imagenSubir);
      console.log(imagenSubir.name)
      storageRef = firebase.storage().ref("imagenes/" + imagenSubir.name ) // directorio raiz
      // storageRef = firebase.storage.ref()// hijo del direcctorio raiz
      var uploadTAsk = storageRef.put(imagenSubir);       
      console.log("Estoy en subir imagen");
      console.log(uploadTAsk)
         // console.log("Respuesta" + uploadTAsk)
      }

  </script>

    // const btnRegister = document.getElementById("btnRegister");
    // btnRegister.addEventListener('click',()=>{
    //     console.log("Evento accionado boton add data");
    //     subirImagen();
    // },true);
// service firebase.storage {
//   match /b/{bucket}/o {
//     match /{allPaths=**} {
//       allow read, write: if request.auth != null;
//     }
//   }
// }
  // Initialize Firebase
  // var config = {
  //   apiKey: "AIzaSyAWe_eDwVTwISgCcCDy5PPxW4bZlq6sHCQ",
  //   authDomain: "tfg-findegrado.firebaseapp.com",
  //   databaseURL: "https://tfg-findegrado.firebaseio.com",
  //   projectId: "tfg-findegrado",
  //   storageBucket: "tfg-findegrado.appspot.com",
  //   messagingSenderId: "281469807949"
  // };
  // firebase.initializeApp(config);

  // const firestore = firebase.firestore();
  // const settings  = {timestampsInSnapshots: true};
  // firestore.settings(settings);
///////////////////////////graficas.



// Create the data table.
 var data = new google.visualization.DataTable();
 data.addColumn('string', 'Topping');
 data.addColumn('number', 'Slices');
 data.addRows([
  ['Mushrooms', 3],
  ['Onions', 1],
  ['Olives', 1], 
  ['Zucchini', 1],
  ['Pepperoni', 2]
  ]);
 // Set chart options
 var options = {'title':'How Much Pizza I Ate Last Night', width: '100%', height: '100%'};
  // Instantiate and draw our chart, passing in some options.
 var chart = new google.visualization.BarChart(document.getElementById('graphics'));
 chart.draw(data, options);



///////////////////////////////

////////////////////get in////////////////////////////////////
  
video{
    width: 100%;
    height: 100%
    margin-bottom: 10px;
}

  <div class="row mb-3">
          <p id="pCheckFText" class="col-sm-10" ></p>
          <div id="divCheckFRed" class="col-sm-1 button-red"></div>
          <div class="col-sm-1"></div>
        </div>
        <script>
      // Initialize Firebase
      var config = {
        apiKey: "AIzaSyAWe_eDwVTwISgCcCDy5PPxW4bZlq6sHCQ",
        authDomain: "tfg-findegrado.firebaseapp.com",
        databaseURL: "https://tfg-findegrado.firebaseio.com",
        projectId: "tfg-findegrado",
        storageBucket: "tfg-findegrado.appspot.com",
        messagingSenderId: "281469807949"
      };
      firebase.initializeApp(config);
      //coneccion a firebase y mandarpara ariiba
      function subirDatos(json){
            console.log("Estoy Subinedo Datos.");
      storageRef = firebase.database().ref(); // directorio raiz  
      // obj JSON
      var obj = JSON.parse(json)
      var uploadTAsk = storageRef.push(json);     
      console.log("Respuesta" + uploadTAsk);    
       }

        
        <div  class="row mb-3">
          <button class="col-sm-4 btn btn-secondary my-2" type="button" id="btnCheckI" >Check image</button>
          <p class="col-sm-6" id="pCheckIText"></p>
          <div class="col-sm-1 button-red" id="divCheckIRed"></div>
          <div class="col-sm-1"></div>
        </div>
 
    
          <button class="btn btn-primary col-sm-6" type="button" id="btnOpenDoor" disabled>Open the door</button>
   var time = 3000;
   setInterval("otro()",time );
   function otro(){
     "EStoty es para ver los datos que se le pasan a un archivo json y mostrarlo en mi tal como info si esto es ok time cam se la llama a los 10 segundos"

     /* metes setTimeout(funcAvisa,10000); despu de tal para que llame a la funcio solo se llma una vez desde que una vez sea correct otodo de ptua madre*/
      console.log("Estoy en otro 3000")
   }

    setTimeout("uno()",10000);
     function uno(){
         // se cambia a rojo otrao vez y time se le cambia el baoo datos
        alert("UFfffffffffffffffffffffffffff")
     }

    </script>
////////////////////get in////////////////////////////////////
app.get('/video', function(req, res) {
  const path = 'assets/sample.mp4'
  const stat = fs.statSync(path)
  const fileSize = stat.size
  const range = req.headers.range

  if (range) {
    const parts = range.replace(/bytes=/, "").split("-")
    const start = parseInt(parts[0], 10)
    const end = parts[1]
      ? parseInt(parts[1], 10)
      : fileSize-1

    const chunksize = (end-start)+1
    const file = fs.createReadStream(path, {start, end})
    const head = {
      'Content-Range': `bytes ${start}-${end}/${fileSize}`,
      'Accept-Ranges': 'bytes',
      'Content-Length': chunksize,
      'Content-Type': 'video/mp4',
    }

    res.writeHead(206, head)
    file.pipe(res)
  } else {
    const head = {
      'Content-Length': fileSize,
      'Content-Type': 'video/mp4',
    }
    res.writeHead(200, head)
    fs.createReadStream(path).pipe(res)
  }
})
////////////////////Consultas/////////////////////////////////////////////////////////////////
function upDateaaa(firstName, lastName,workPosition, email, otherInfo, picture) {
  // Usuar exist
  // Initialize Cloud Firestore through Firebase
  var db = firebase.firestore();

  var docRef = db.collection("users").doc(email);
  docRef.get().then(function(doc) {
    if (doc.exists) {
        console.log("Document data:", doc.data());
         alert("User exist");
    } else {
        // doc.data() will be undefined in this case
        console.log("No such document!");
        alert("New User");
        sendDateFerestore(firstName, lastName,workPosition, email, otherInfo, picture)
    }
  }).catch(function(error) {
      console.log("Error getting document:", error);
  });
  //  var docRef = db.collection("users").doc(email);
  // userdb.get().then(function(doc) {

  //   if (doc.exists) {
  //       console.log("Document data:", doc.data());
  //        alert("User exist");
  //   } else {
  //       // doc.data() will be undefined in this case
  //       console.log("No such document!");
  //       alert("New User");
  //       sendDateFerestore(firstName, lastName,workPosition, email, otherInfo, picture);
  //   }
  // }).catch(function(error) {
  //     console.log("Error getting document:", error);
  // });
}


function upDateaTiempoREal(firstName, lastName,workPosition, email, otherInfo, picture) {

  var userData = {
    id: email,
    firstName: firstName,
    lastName: lastName,
    workPosition: workPosition,
    email: email,
    otherInfo: otherInfo,
    authorPic: picture
  };
  // Get a key for a new Post.
  var newUserKey = firebase.database().ref().child('users').push().key;

  // Write the new user.
  var updates = {};
  updates['/users/' + newUserKey] = userData;
  // para hacerlo simutanio
  //updates['/user-posts/' + uid + '/' + newPostKey] = postData;

  // The parent of any non-root reference is the parent location
  var usersRef = firebase.database().ref("users");
  var postId ="LZdnXSBw0kGVlqsMWTw";
  return firebase.database().ref().update(updates);
}

  // // Add a second document with a generated ID.
  // db.collection("users").doc().set(userData)
  //               .then(function(docRef) {
  //                 console.log("Document written with ID: ", docRef.id);
  //               }).catch(function(error) {
  //                 console.error("Error adding document: ", error);
  //               });

function consultas(){
  // Initialize Cloud Firestore through Firebase
  var db = firebase.firestore();
// Add a second document with a generated ID.
db.collection("users").add({
    first: "Alan",
    middle: "Mathison",
    last: "Turing",
    born: 1912
})
.then(function(docRef) {
    console.log("Document written with ID: ", docRef.id);
})
.catch(function(error) {
    console.error("Error adding document: ", error);
});
var aux = db.collection("users").where("born", "==", "soy_yo000@hotmail.com")
    .get()
    .then(function(querySnapshot) {
        console.log("consulasdododoo");
        console.log(aux);
        querySnapshot.forEach(function(doc) {
            // doc.data() is never undefined for query doc snapshots
            console.log(doc.born, " => ", doc.data());
        });
    })
    .catch(function(error) {
        console.log("Error getting documents: ", error);
    });


 

}


  function subirDatos(){
    storageRef = firebase.database().ref();
    console.log("Estoy Subinedo Datos.");
  
    console.log("Estoy Subinedo Datos.2");    
      // Consulta si existe email
      

      var uploadTAsk = storageRef.child("usuarios").child(id).on('value', function(snapshot) {
        console.log(snapshot.val);
        console.log("Estoy Subinedo Datos.");
        var id = email.value.replace(".", "_");
        console.log(id);
        var json={};
        json.email = id;
        json.nombre = firstName.value;
        json.apellidos = lastName.value;
        json.puesto = workPosition.value;
        console.log(otherInfo.value);
        json.otraInfo = otherInfo.value;
        console.log(json);

        var uploadTAsk = storageRef.child("usuarios").child(id).set(json);
        //updateStarCount(postElement, snapshot.val());
      });
  }
    
  ///////////////////////////////////////
  var HttpClient = function() {
      this.get = function(aUrl, aCallback) {
          var anHttpRequest = new XMLHttpRequest();
          anHttpRequest.onreadystatechange = function() {  
              if (anHttpRequest.readyState == 4 && anHttpRequest.status == 200){
                   aCallback(anHttpRequest.response);
              }
     
         }
         anHttpRequest.open( "GET", aUrl,false );            
         anHttpRequest.send(null);  
      }
  }
  /////////////////////////////////////////////////////
//////////////////////////////////////Consulatas/////////////////////////////////////////////
<!DOCTYPE html>
<html lang="en">
<head>
     <% include ../views/head.ejs %>
     <!-- Custom styles for this template -->
      <link href="/stylesheets/video.css" rel="stylesheet">
     <script src="https://www.gstatic.com/firebasejs/5.4.0/firebase.js"></script>
    <script>
      // Initialize Firebase
     // var config = {
       // apiKey: "AIzaSyAWe_eDwVTwISgCcCDy5PPxW4bZlq6sHCQ",
       // authDomain: "tfg-findegrado.firebaseapp.com",
       // databaseURL: "https://tfg-findegrado.firebaseio.com",
       // projectId: "tfg-findegrado",
      //  storageBucket: "tfg-findegrado.appspot.com",
       // messagingSenderId: "281469807949"
     // };
   //   firebase.initializeApp(config);
 
 console.log(firebase);

function subirImagen(){
    
    var fichero = document.getElementById("imagen");
    console.log(fichero.files[0])
     var imagenSubir = fichero.files[0];
     console.log(imagenSubir);
     console.log(imagenSubir.name)
     storageRef = firebase.storage().ref("imagenes/" + imagenSubir.name ) // directorio raiz
    // storageRef = firebase.storage.ref()// hijo del direcctorio raiz
     var uploadTAsk = storageRef.put(imagenSubir)
     
     console.log("Estoy en subir imagen");
     console.log(uploadTAsk)
   // console.log("Respuesta" + uploadTAsk)
}
    </script>
 
</head>
<body class="container">
  <% include ../views/navAdm.ejs %>
  <main>
    <div class="py-5 text-center">
      <h2>Insertar un nuevo usuario en el sistema</h2>
      <p class="lead">Para poder insertar un nuevo usuario en el sitema seguir paso a paso el proceso y presional alfinal registras. Tiene un tiempo limitado sino volvera a tener que relizar el 
      proceso.</p>
    </div>
    <div class="row">
      <div class="col-md-12 order-md-1">
        <form role="form">
          <h4 class="row mb-3">1. Personal information.</h4>
            <div class="row form-group">
                <div class="col-md-4 mb-3">
                  <label for="firstName">First name</label>
                  <input type="text" class="form-control" id="firstName" placeholder="First name" required >
                  <div class="invalid-feedback">
                    Valid first name is required.
                  </div>
                </div>
                <div class="col-md-4 mb-3">
                  <label for="lastName">Last name</label>
                  <input type="text" class="form-control" id="lastName" placeholder="Last name" required>
                  <div class="invalid-feedback">
                    Valid last name is required.
                  </div>
                </div>
                <div class="col-md-4 mb-3">
                   <label for="address">Work position</label>
                   <input type="text" class="form-control" id="workPosition" placeholder="Work position" required>
                   <div class="invalid-feedback">
                   Please enter your shipping address.
                   </div>
                </div>
            </div>
            <div class="row form-group">
                <div class="col-md-4 mb-3">
                 <label for="email">Email</label>
                 <input type="email" class="form-control" id="email" placeholder="you@example.com">
                 <div class="invalid-feedback">
                  Please enter a valid email address for shipping updates.
                </div>
                </div>
                <div class="col-md-8 mb-3">
                   <label for="address">Other info(Opcional)</label>
                   <textarea rows="4" cols="50" type="text" class="form-control" id="OtherInfo" placeholder="Other Info"></textarea>
                   <div class="invalid-feedback">
                   Please enter your shipping address.
                 </div>
                </div>
            </div>
            <div class="row form-group">    
                  <button class="btn btn-secondary btn-lg btn-block col-sm-4" onsubmit="false;" type="submit" id="btnAddData" >Add Personal Data</button>
                  <p id="pDataText" class="col-sm-6" ></p>
                  <div id="divDataRed" class="col-sm-1 button-red"></div>
                  <div class="col-sm-1"></div>
            </div>
        </form>
        <!--hr class="mb-4"-->
        <form role="form">
          <h4 class="mb-3">2. Insert footprint.</h4>
          <div class="row"> 
                <button class="btn btn-secondary btn-lg btn-block col-sm-4"  type="button" id="btnAddFootprint">Add Footprint</button>
                <p id="pFootprintText" class="col-sm-6" ></p>
                <div id="divFootprintRed" class="col-sm-1 button-red"></div>
                <div class="col-sm-1"></div>
          </div>
        </form>
         <!--hr class="mb-4"-->
        <form>
          <h4 class="mb-3">3. Insert photography.</h4>
          <div class="row mb-3"> 
                 <div class="col-sm-6"> 
                    <div class="row"> 
                      <video class="col-sm-12" id="video" src="blob:https://www.onlinemictest.com/9e7d9bd6-b6d8-4850-9787-5ded8d403048" muted autoplay>
                         Tu navegador no es compatible con la etiqueta video de HTML5.
                         <canvas id="canvas"></canvas>
                      </video>     
                      
                    </div>
                    <div class="row"> 
                       <div class="col-sm-4"></div>
                       <button id="btnTakePhoto" type="button" class="btn btn-success col-sm-4">Take photo</button> 
                       <div class="col-sm-4"></div>
                    </div>
                 </div>
                 <div class="col-sm-6">
                   <img class="img-responsive" src="images/face.png" id="photo" alt="photo">
                 </div>
          </div>
          <div class="row">    
                <button class="btn btn-secondary btn-lg btn-block col-sm-4 " type="button" id="btnAddImage">Add Image</button>
                <p id="pImageText"class="col-sm-6" ></p>
                <div id="divImageRed" class="col-sm-1 button-red"></div>
                <div class="col-sm-1"></div>
          </div>
        </form>
         <!--hr class="mb-4"-->
        <h4 class="mb-3">4. Registration .</h4>
          <button class="btn btn-primary btn-lg btn-block" onclick="subirImagen()" type="submit" id="btnRegister" >Register user</button>
        </form>
         <!--hr class="mb-4"-->
      </div>
    </div>
    <footer class="my-5 pt-5 text-muted text-center text-small">
        <p class="mb-1">&copy; 2017-2018 Company Name</p>
        <ul class="list-inline">
          <li class="list-inline-item"><a href="#">Privacy</a></li>
          <li class="list-inline-item"><a href="#">Terms</a></li>
          <li class="list-inline-item"><a href="#">Support</a></li>
        </ul>
    </footer>
  </main>

  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>

  <script src="/javascripts/newUser.js"></script>
  <script src="/javascripts/video.js"></script>

</body>
</html>


